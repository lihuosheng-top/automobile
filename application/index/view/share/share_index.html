<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>晒单</title>
    
	<link rel="icon" type="image/x-icon" href="__STATIC__/index/favicon.ico">
    <link rel="stylesheet" type="text/css" href="__STATIC__/index/css/aui.css" />
    
    <style>
        a,b,body,div,dl,dt,h1,h2,h3,h4,h5,i,img,input,li,ol,option,p,pre,select,table,td,textarea,tr,ul{
            margin:0;padding:0
        }
        article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{
            display:block
        }
        img,input{
            border:0;outline:none
        }
        ul{
            list-style:none
        }
        a:hover,a:link,a:visited{
            text-decoration:none
        }
        .clear{
            clear:both
        }
        i{
            font-style:normal
        }
        img{vertical-align:middle}
        *{
            -webkit-sizing:border-box;box-sizing:border-box
        }
        html{
            font-size:20px;background:#fafafa
        }
        body, html{
            overflow-x: hidden;
        }
        body{
            position: relative;
            max-width: 640px;
            min-width: 320px;
            margin: 0 auto;
            font-size: 14px;
            color: #666;
        }
        /* wrapper */
        .wrapper{
            width: 100%;
            height: 100vh;
            background-color: #fafafa;
        }
        /* 头部 */
        .header_fixed{
            position: relative;
            width: 100%;
            height: 47px;
            line-height: 47px;
            font-size: 12px;
            padding: 0 10px;
            background-color: #fff;
        }
        .select_box{
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            -webkit-transform: translateY(-50%);
            font-size: 14px;
            z-index: 99;
        }
        .select_btn{
            width: 72px;
            height: 27px;
            line-height: 27px;
            text-align: center;
            border-radius: 14px;
            border: 1px solid #d9d9d9;
            color: #fe6546;
        }
        .upOrDown{
            display: none;
        }
        .select_menu{
            position: absolute;
            left: 0;
            right: 5px;
            margin: 5px -5px 0;
            padding: 0 8px;
            text-align: center;
            line-height: normal;
            background-color: #fff;
            color: #333;
            box-shadow: 0 4px 10px 0 rgba(0,0,0,.1);
            border-radius: 4px;
            height: 260px;
            overflow-y: scroll;
        }
        .select_menu li{
            padding: 10px 0;
            border-bottom: 1px solid #ccc;
        }
        .select_menu li:last-of-type{
            border-bottom: none;
        }
        /* 评论区 */
        .list_box section{
            margin-bottom: 8px;
            padding: 15px 15px 0;
            background-color: #fff;
            font-size: 14px;
            color: #333;
        }
        .list_view .user_box{
            height: 42px;
        }
        .list_view .user_img{
            float: left;
            margin-right: 10px;
        }
        .list_view .user_img img{
            width: 42px;
            height: 42px;
            border-radius: 50%;
            overflow: hidden;
        }
        .list_view .user_msg{
            height: 42px;
        }
        .list_view .user_msg .user_name{
            font-size: 14px;
            color: #333;
        }
        .list_view .user_msg .user_name span{
            vertical-align: middle;
        }
        .list_view .user_msg .product_label{
            display: inline-block;
            padding: 0 5px;
            background-color: #ffebe7;
            font-size: 10px;
            color: #fe6546;
            border-radius: 25px;
        }
        .comment_box{
            margin: 13px 0 10px;
            line-height: 24px;
            color: #7f7f7f;
        }
        .list_footer{
            position: relative;
            padding: 14px 0;
            color: #666;
            border-top: 1px solid #f2f2f2;
        }
        .list_footer .operation{
            position: absolute;
            top: 50%;
            right: 0;
            font-size: 0;
            transform: translateY(-50%);
            -webkit-transform: translateY(-50%);
        }
        .list_footer .operation a{
            display: inline-block;
            width: 62px;
            height: 28px;
            line-height: 28px;
            margin-left: 10px;
            text-align: center;
            border-radius: 14px;
            font-size: 12px;
            border: 1px solid #cecece;
            color: #999;
        }
        p.all{
            display: inline-block;
            font-size: 14px;
            color: #fe6546;
            line-height: 27px;
            text-align: center;
        }
        .show-image{
            position: fixed;
            left:0;
            top:0;
            width:100%;
            height:100vh;
            display:none;
            background:#000;
            z-index: 999;
        }
        .show-image img{
            position: absolute;
            left:50%;
            top:50%;
            transform: translate(-50%,-50%);
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="header_fixed">
            点击右边的按钮可以切换不同分类的晒单哦
            <div class="select_box">
                <div class="select_btn select_phone_type">
                    <p class="all">全部</p>
                    <span class="up">▴</span>
                    <span class="down upOrDown">▾</span>
                </div>
                <ul class="select_menu upOrDown">
                    <!-- <li>全部</li> -->
                </ul>
            </div>
        </div>
        <div class="list_box">
            <!-- <section class="list_view">
                <div class="user_box">
                    <div class="user_img">
                        图片
                        <img src="">
                    </div>
                    <div class="user_msg">
                        <div class="user_name">
                            <span>电话号码</span>
                        </div>
                        <span class="product_label">商品名字</span>
                    </div>
                </div>
                <div class="comment_box"></div>
                <div class="upload-img-view">
                    <ul data-index="0" class="list-img-box clearfix"></ul>
                </div>
                <div class="list_footer">
                    <span class="time_box">
                       时间
                    </span>
                    <div class="operation">
                        <a  id="see_evaluation_id" class="see_evaluation">
                            <span>查看评论</span>
                        </a>
                    </div>
                </div>
            </section> -->
            <section class="list_view">
                <div class="user_box">
                    <div class="user_img">
                        <img src="__UPLOADS__/20180929/125f3d48fb5b87a0d43240f1ad0504b3.jpg">
                    </div>
                    <div class="user_msg">
                        <div class="user_name">
                            <span>13691853045</span>
                        </div>
                        <span class="product_label">123456789</span>
                    </div>
                </div>
                <div class="comment_box">评论的内容</div>
               <div class="eva_img_div">
                    <div class="tpfd" style="width:60px;height:40px;display:inline-block;margin-right:6px;">
                        <img src="__UPLOAD__/20181008/399e32753faf4d64d7186736216925c2.jpg">
                    </div>
                    <div class="tpfd" style="width:60px;height:40px;display:inline-block;margin-right:6px;">
                        <img src="__UPLOAD__/20181008/89cc1eda93b3ba5ae59f33aaf4d9361a.jpg">
                    </div>
                    <div class="tpfd" style="width:60px;height:40px;display:inline-block;margin-right:6px;">
                        <img src="__UPLOAD__/20181008/0950a9fd8050d3a0c1d6b6b6214f1d79.jpg">
                    </div>
               </div>
                <div class="list_footer">
                    <span class="time_box">2018-10-8 19:17:11</span>
                    <div class="operation">
                        <a href="javascript:;" class="see_evaluation">
                            <span>查看评论</span>
                        </a>
                    </div>
                </div>
            </section>
        </div>
    </div>
<div class="show-image"></div>

    
<script src="__STATIC__/index/js/jquery.js"></script>
<script src="__STATIC__/index/js/zepto.js"></script>
<script src="__STATIC__/index/js/touch.js"></script>
<script src="__STATIC__/index/js/animate.js"></script>
<!-- 筛选列表 切换类名 -->
<script>
    $('.select_btn').click(function(){
        $('.up').toggleClass('upOrDown').siblings('span').toggleClass('upOrDown');
        $('.select_menu').toggleClass('upOrDown');
    })
</script>
<!--点击获取手机品种类型-->
<script>
        function timetrans(date){
            var date = new Date(date*1000);//如果date为13位不需要乘1000
            var Y = date.getFullYear() + '-';
            var M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
            var D = (date.getDate() < 10 ? '0' + (date.getDate()) : date.getDate()) + ' ';
            var h = (date.getHours() < 10 ? '0' + date.getHours() : date.getHours()) + ':';
            var m = (date.getMinutes() <10 ? '0' + date.getMinutes() : date.getMinutes()) + ':';
            var s = (date.getSeconds() <10 ? '0' + date.getSeconds() : date.getSeconds());
            return Y+M+D+h+m+s;
        }
        $('.select_phone_type').click(function () {
            $.ajax({
                type:'POST',
                url:'{:url("index/Share/phone_type")}',
                dataType: 'json',
                success: function(data){
                    // console.log(data);
                    var len = data.data.length;
                    $('.select_menu').html('');
                    $('.select_menu').append('<li class="li_2">全部</li>')
                    for(var i = 1; i < len; i++){
                        $('.select_menu').append('<li class="li_'+data.data[i].id+'">'+data.data[i].name+'</li>');
                    }
                },
                error:function(data) {
                    console.log("失败");
                },
            });
        })
        // 利用事件委托获取id
        $('.select_menu').click(function(e){
            var id = e.target.className.split('_')[1];
            $.ajax({
                type:'POST',
                url:'{:url("index/Share/get_phone_type_informations")}',
                data:{
                    'id':id
                },
                dataType: 'json',
                success: function(data){
                    console.log(data);
                    $('.select_phone_type .all').html(e.target.innerHTML);
                    $('.select_menu').addClass('upOrDown');
                    var str = '';
                    var reg = /(\d{3})(\d{4})(\d{4})/;
                    if(data != null){
                        // 第一次循环
                        $.each(data.data,function(idx, val){
                            console.log('第1次:'+idx,val)
                            if(Array.isArray(val)){
                            // 第二次循环
                                $.each(val,function(idx, val){
                                    console.log('第2次:'+idx,val)
                                    var imgStr = '<div class="tpfd" style="width:60px;height:40px;display:inline-block;margin-right:6px;">';
                                    var imgLen = val.evaluate_images.length;
                                    for(var i = 0; i < imgLen; i++){
                                        imgStr +='<img src="__UPLOAD__/'+val.evaluate_images[i].images+'">'
                                    }
                                    imgStr += '</div>';
                                    str += '<section class="list_view">\
                                                <div class="user_box">\
                                                    <div class="user_img">\
                                                        <img src="__UPLOADS__/'+val.goods_show_images+'">\
                                                    </div>\
                                                    <div class="user_msg">\
                                                        <div class="user_name">\
                                                            <span>'+val.phone_num.replace(reg,'$1****$3')+'</span>\
                                                        </div>\
                                                        <span class="product_label">'+val.goods_name+'</span>\
                                                    </div>\
                                                </div>\
                                                <div class="comment_box">'+val.evaluate_content+'</div>\
                                                <div class="eva_img_div">'+imgStr+'</div>\
                                                <div class="list_footer">\
                                                    <span class="time_box">'+timetrans(val.create_time)+'</span>\
                                                    <div class="operation">\
                                                        <!--这里你需要绑定一个id就是see_evaluation+一个回来的id-->\
                                                        <a id="see_evaluation_'+val.id+'" class="see_evaluation">\
                                                            <span>查看评论</span>\
                                                        </a>\
                                                    </div>\
                                                </div>\
                                            </section>'
                                })
                            }else{
                                str += '<section class="list_view">\
                                            <div class="user_box">\
                                                <div class="user_img">\
                                                    <img src="__UPLOADS__/'+val.goods_show_images+'">\
                                                </div>\
                                                <div class="user_msg">\
                                                    <div class="user_name">\
                                                        <span>'+val.phone_num.replace(reg,'$1****$3')+'</span>\
                                                    </div>\
                                                    <span class="product_label">'+val.goods_name+'</span>\
                                                </div>\
                                            </div>\
                                            <div class="comment_box">'+val.evaluate_content+'</div>\
                                            <div class="list_footer">\
                                                <span class="time_box">'+timetrans(val.create_time)+'</span>\
                                                <div class="operation">\
                                                    <a id="see_evaluation_'+val.id+'" class="see_evaluation">\
                                                        <span>查看评论</span>\
                                                    </a>\
                                                </div>\
                                            </div>\
                                        </section>'
                            }
                            $('.list_box').html('');
                            $('.list_box').append(str);

                            // 图片放大
                            // 给tpfd添加点击事件，事件委托img，获取img的src路径
                            $('.tpfd img').click(function(){
                                var src = $(this)[0].src;
                                activeIndex = $(this).index();
                                loadImage(src);
                            })
                            //show-image添加图片
                            //获取可视窗口比例
                            var bili = $(window).height() / $(window).width();
                            function loadImage(src) {
                                $('.show-image').empty().show();//清空之前的图片
                                var oImg = new Image(),
                                    oImage_src = src;
                                oImg.src = oImage_src;
                                oImg.onload = function () {
                                    //等图片下载完再显示
                                    //获取图片宽高比例
                                    var img_h = this.height,
                                        img_w = this.width;
                                    if(img_h / img_w > bili){
                                        $(oImg).appendTo($('.show-image')).css('height','100%').animate({opacity:1},500);
                                    }else{
                                        $(oImg).appendTo($('.show-image')).css('width','100%').animate({opacity:1},500);
                                    }
                                }
                            }
                            // 查看评价信息
                            $('.see_evaluation').click(function(){
                                var see_evaluation_id = $(this)[0].id.split('_')[2];
                                $.ajax({
                                    type:'POST',
                                    url:'{:url("index/Share/share_evaluation")}',
                                    data:{
                                        'evaluation_id':see_evaluation_id
                                    },
                                    dataType: 'json',
                                    success: function(data){
                                        console.log(data);
                                        window.location.href="{:url('index/Share/share_detail')}"
                                    },
                                    error:function(data) {
                                        console.log("失败");
                                    },
                                });
                            });
                        })
                    }else{
                        $('.list_box').html('');
                        return;
                    }
                },
                error:function(data) {
                    console.log("失败");
                },
            });
        })
</script>
<!--一进入晒单页面显示的信息-->
<script>
    (function(){
        $.ajax({
            type:'POST',
            url:'{:url("index/Share/all_information_share")}',
            data:{
            },
            dataType: 'json',
            success: function(data){
                console.log(data);
                if(data !== null){
                    var str = '';
                    var reg = /(\d{3})(\d{4})(\d{4})/;
                    $.each(data.data,function(idx, val){
                        if(val.phone_num != null){
                            val.phone_num = val.phone_num.replace(reg,'$1****$2');
                        }
                        var imgStr = '<div class="tpfd" style="width:60px;height:40px;display:inline-block;margin-right:6px;">';
                        var imgLen = val.evaluate_images.length;
                        for(var i = 0; i < imgLen; i++){
                            imgStr +='<img src="__UPLOAD__/'+val.evaluate_images[i].images+'">'
                        }
                        imgStr += '</div>';
                        str += '<section class="list_view">\
                                    <div class="user_box">\
                                        <div class="user_img">\
                                            <img src="__UPLOADS__/'+val.goods_show_images+'">\
                                        </div>\
                                        <div class="user_msg">\
                                            <div class="user_name">\
                                                <span>'+val.phone_num+'</span>\
                                            </div>\
                                            <span class="product_label">'+val.goods_name+'</span>\
                                        </div>\
                                    </div>\
                                    <div class="comment_box">'+val.evaluate_content+'</div>\
                                    <div class="eva_img_div">'+imgStr+'</div>\
                                    <div class="list_footer">\
                                        <span class="time_box">'+timetrans(val.create_time)+'</span>\
                                        <div class="operation">\
                                            <!--这里你需要绑定一个id就是see_evaluation+一个回来的id-->\
                                            <a href="javascript:;" id="see_evaluation_'+val.id+'" class="see_evaluation">\
                                                <span>查看评论</span>\
                                            </a>\
                                        </div>\
                                    </div>\
                                </section>'
                    })
                    // $('.list_box').html('');
                    $('.list_box').append(str);
                }
                var img_num;
                var activeBox;//用户点击当前图片的父级盒子
                // 图片放大
                // 给tpfd添加点击事件，事件委托img，获取img的src路径
                $('.tpfd').click(function(){
                    var src = $(this).children('img')[0].src;
                    activeIndex = $(this).index();
                    img_num = $(this).parents('.eva_img_div').children('div').length;
                    activeBox = $(this).parents('.eva_img_div');
                    loadImage(src);
                })
                //show-image添加图片
                //获取可视窗口比例
                var bili = $(window).height() / $(window).width();
                function loadImage(src) {
                    $('.show-image').empty().show();//清空之前的图片
                    var oImg = new Image(),
                        oImage_src = src;
                    oImg.src = oImage_src;
                    oImg.onload = function () {
                        //等图片下载完再显示
                        //获取图片宽高比例
                        var img_h = this.height,
                            img_w = this.width;
                        if(img_h / img_w > bili){
                            $(oImg).appendTo($('.show-image')).css('height','100%').animate({opacity:1},500);
                        }else{
                            $(oImg).appendTo($('.show-image')).css('width','100%').animate({opacity:1},500);
                        }
                    }
                }
                var activeIndex;//在tpfd的点击事件中获取当前图片的索引值
                $('.show-image').on('tap',function(){
                        $('.show-image').hide();
                    })
                    .on('swipeLeft',function(){
                        activeIndex++;
                        if(activeIndex > img_num - 1){
                            activeIndex = img_num - 1;
                        }else{
                            // 下一张图片的src
                            var src = $($(activeBox).children('div')[activeIndex]).children('img')[0].src;
                            loadImage(src);
                        }
                    })
                    .on('swipeRight',function(){
                        activeIndex--;
                        if(activeIndex < 0){
                            activeIndex = 0
                        }else{
                            // 上一张图片的src
                            var src = $($(activeBox).children('div')[activeIndex]).children('img')[0].src;
                            loadImage(src);
                        }
                    })

                // 查看评价信息
                $('.see_evaluation').click(function(){
                    var see_evaluation_id = $(this)[0].id.split('_')[2];
                    $.ajax({
                        type:'POST',
                        url:'{:url("index/Share/share_evaluation")}',
                        data:{
                            'evaluation_id':see_evaluation_id
                        },
                        dataType: 'json',
                        success: function(data){
                            console.log(data);
                            window.location.href="{:url('index/Share/share_detail')}"
                        },
                        error:function(data) {
                            console.log("失败");
                        },
                    });
                });
            },
            error:function(data) {
                console.log("失败");
            },
        });
    })()
</script>
</body>
</html>