 <!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover"/>
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>商品详情</title>
	<style type="text/css">
		.aui-bar-tab {
			position: static;
		}
		.search-input {
			height: 1.6rem;
			line-height: 1.6rem;
			background: #f5f5f5;
			border-radius: 30px;
			position: relative;
			font-family: "aui_iconfont" !important;
			text-align: left;
			padding-left: 1.5rem;
			color: #999999;
		}
		.search-input:after {
			position: absolute;
			left: 0;
			padding-left: 0.5rem;
			content: "\e615";
		}
		.goods_parts{
			display: flex;
			align-items: center;
			font-size: 12px;
			color: #000;
		}
		.goods_parts_img{
			display: inline-block;
			width: 20px;
			height: 20px;
			overflow: hidden;
			margin-right: 5px;
		}
		.goods_parts_img img{
			width: 100%;
			height: 100%;
		}
		.goods_parts_big_img{
			display: none;
			position: fixed;
			left: 0;
			top: 0;
			width: 100%;
			height: 100vh;
			background-color: #fff;
			z-index: 999;
		}
		.goods_parts_big_img a{
			position: absolute;
			right: 0;
			top: 0;
			font-size: 35px;
			color: #aaa;
			width: 40px;
			height: 40px;
			text-align: center;
			line-height: 40px;
		}
		.goods_parts_big_img div{
			margin-top: 40px;
			width: 100%;
			height: auto;
			overflow-y: scroll;
		}
		.goods_parts_big_img div img{
			width: 100%;
			height: auto;
		}
		.aui-card-list{
			overflow-x: scroll;
			overflow-y: hidden;
			height: 65px;
		}
		.aui-card-list img{
			max-width: initial;
		}
		.tabClick{
			display: none;
			width: 100%;
			height: 40px;
			position: fixed;
			top: 50px;
			left: 0;
			z-index: 998;
			background-color: rgba(200, 200, 200, .3);
		}
		.aui-border-t{
			display: flex !important;
			justify-content: space-around;
			align-items: center;
			height: 55px;
		}
		.aui-text-white{
			height: 36px;
			line-height: 36px;
			padding: 0 20px;
		}
		.kefu{
			display: inline-block;
			width: 22px;
			height: 22px;
			background: url(__STATIC__/index/image/icon/kefu.png) no-repeat;
			background-size: 100%;
			vertical-align: sub;
		}
		.zjsp_title,
		.zjtp_title{
			font-size: 18px;
			color: #000;
			padding: 8px 0 8px 5px;
		}
		.zjsp_title::before,
		.zjtp_title::before{
			content: '|';
			color: #f00;
			font-weight: bold;
		}
		.zjsp_title span{
			font-size: 13px;
			color: #aaa;
		}
		/* 图片放大样式 */
		.show-image{
            position: fixed;
            left:0;
            top:0;
            width:100%;
            height:100vh;
            display:none;
            background:#000;
            z-index: 999;
        }
        .show-image img{
            position: absolute;
            left:50%;
            top:50%;
            transform: translate(-50%,-50%);
            opacity: 0;
        }
		.identifier{
			position: absolute;
			right: 0;
			bottom: 20px;
			padding: 2px 5px;
			background-color: pink;
			border-top-left-radius: 15px;
			border-bottom-left-radius: 15px;
			font-size: 12px;
			color: #fff;
			z-index: 99;
		}
		.goods_parts_cont{
			color: #f00;
		}
		.goods_new_money{
			color: #000;
			font-weight: normal;
			text-decoration: line-through;
			font-size: 14px;
		}
		.imei{
			font-size: 14px;
			padding-left: 7px;
			color: #000;
		}
		.copy_imei{
			display: inline-block;
			border: 1px solid #f00;
			color: #f00;
			border-radius: 3px;
			margin-left: 20px;
			padding: 0 2px;
			font-size: 12px;
			line-height: 12px;
		}
		.fixed{
			position: fixed !important;
			z-index: 999 !important;
		}
	</style>
	<link rel="icon" type="__STATIC__/index/image/x-icon" href="__STATIC__/index/favicon.ico">
	<link rel="stylesheet" type="text/css" href="__STATIC__/index/css/aui.css"/>
	<link rel="stylesheet" type="text/css" href="__STATIC__/index/css/aui-slide.css"/>
    <link rel="stylesheet" href="__STATIC__/index/css/seckill.css">
	<link rel="stylesheet" type="text/css" href="__STATIC__/index/css/pop.css"/>
	<link rel="stylesheet" href="__STATIC__/index/css/swiper-4.3.5.min.css">
</head>
<body style="background:#fff">
<header class="aui-bar aui-bar-nav fixed">
	<a class="aui-pull-left aui-btn" href="javascript:history.back(-1);">
		<span class="aui-iconfont aui-icon-left" style="font-weight:800"></span>
	</a>
	<div class="aui-title">商品详情</div>
</header>
<div id="aui-slide2" style="margin-top:50px;">
	<div class="aui-slide-wrap" style="height:100%;">
		<div class="swiper-container" style="height:100%;">
			<div class="swiper-wrapper">

			</div>
			<!-- 如果需要分页器 -->
			<!-- <div class="swiper-pagination"></div> -->
		</div>
	</div>
	<!-- <div class="aui-slide-page-wrap"> -->
		<!--分页容器-->
	<!-- </div> -->
	<span class="identifier"></span>
</div>
<div class="aui-title-text ">
	<h2 class="goods_desc">
		<!-- <i><img src="__STATIC__/index/image/l.png" alt=""></i>
		<span>促销</span>
		荣耀V9play全网通 标配版 3GB+32GB 幻夜黑 移动联通电信4G手机 双卡双待 -->
	</h2>
	<div style="font-size:18px; font-weight:800; color:#f34347" class="price">￥1299.00
	</div>
	<div class="time_box" style="text-align:right; display: none;">
		<span class="time_text">距开始</span>&nbsp;
		<span class="day">0天</span>
		<span class="hour">0</span> :
		<span class="minutes">0</span> :
		<span class="second">0</span>
	</div>
</div>
<div class="div-border t-line"></div>
<div class="aui-title-shout t-line">
	<a href="javascript:$('.goods_parts_big_img').show();">
		<p class="goods_parts">
			<span class="goods_parts_img"></span>
			<span class="goods_parts_cont">【首单支付】首单立减15元</span>
		</p>
	</a>
</div>
<div class="div-border t-line"></div>
<section class="aui-content-padded t-line" style="margin:0">
	<div class="aui-card-list"></div>
</section>
<div class="div-border t-line"></div>
<div class="wrap" id="wrap">
	<ul class="tabClick">
		<li>商品介绍</li>
		<li>规格参数</li>
		<li>包装售后</li>
	</ul>
	<div class="lineBorder">
		<div class="lineDiv"></div>
	</div>
	<div class="tabCon">
		<p class="zjsp_title">真机实拍<span>(眼见为实，所见即所得)</span></p>
		<div class="tabBox"></div>
	</div>
</div>
<div style="height:52px"></div>
<!-- footer -->
<footer class="aui-bar aui-bar-tab aui-margin-t-15  aui-border-t iphonex-pb">
	<div class="aui-bar-tab-item" style="width: 2rem;">
		<i class="kefu"></i><a href="chat"></a>
		<div class="aui-bar-tab-label star_info" style="color:#f00;">客服</div>
	</div>
	<div class="aui-bar-tab-item collection_add" tapmode style="width: 2rem;">
		<i class="aui-iconfont aui-icon-star star_info"></i>
		<div class="aui-bar-tab-label star_info">收藏</div>
	</div>
	<div class="aui-bar-tab-item" style="width: 2rem;">
		<i class="aui-iconfont aui-icon-cart star_info" style="color:#757575"></i>
		<div class="aui-bar-tab-label star_info">购物车</div>
	</div>
	<div class="aui-bar-tab-item aui-bg-warning aui-text-white" tapmode style="border-top-left-radius: 18px;border-bottom-left-radius: 18px;" id="add_to_cart">加入购物车</div>
	<div class="aui-bar-tab-item aui-bg-danger aui-text-white" onclick="toUrl('order_index')" tapmode style="border-top-right-radius: 18px; border-bottom-right-radius: 18px;" id="buy_now">立即购买</div>
</footer>
<!-- 配件大图 -->
<div class="goods_parts_big_img">
	<a href="javascript:$('.goods_parts_big_img').hide();;">×</a>
	<div></div>
</div>
<!-- 图片放大 -->
<div class="show-image"></div>
<script src="__STATIC__/index/js/swiper-4.3.5.min.js"></script>
<script type="text/javascript" src="__STATIC__/index/js/index/api.js"></script>
<script type="text/javascript" src="__STATIC__/index/js/index/aui-popup-new.js"></script>
<script type="text/javascript" src="__STATIC__/index/js/index/aui-slide.js"></script>
<script type="text/javascript" src="__STATIC__/index/js/index/aui-collapse.js"></script>
<script src="__STATIC__/index/js/index/jquery.min.js"></script>
<script src="__STATIC__/index/js/index/ratchet.min.js"></script>
<script src="__STATIC__/index/js/zepto.js"></script>
<script src="__STATIC__/index/js/touch.js"></script>
<script src="__STATIC__/index/js/animate.js"></script>
<script>
	window.onscroll = function() {
		var scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;
		if(scrollTop >= 100){
			$('.tabClick').show();
		}else if(scrollTop == 0){
			$('.tabClick').hide();
		}
	}
	var xid;
	(function(){
		$.ajax({
			url: '{:url("index/Goods/detail")}',
			type: 'POST',
			dataType: 'JSON',
			async: false,
			success: function(data){
				console.log(data)
				var data = data.data[0];
				// 轮播图
				var img_len = data.goods_images.length;
				var str = '';
				for(var i = 0; i < img_len; i++){
					if(data.goods_images[i] !== null){
						$('.swiper-wrapper').append('<div class="swiper-slide"><img src="__UPLOAD__/'+data.goods_images[i]+'"></div>');
						str += '<img src="__UPLOAD__/'+data.goods_images[i]+'">';
					}
				}
				$('.tabBox').append(str);
				// 标题
				var str_title = '';
				var sign_len = data.goods_sign.split(',').length;
				for(var i = 0; i < sign_len; i++){
					str_title += '<span>'+data.goods_sign.split(',')[i]+'</span>';
				}
				$('.goods_desc').html(str_title + data.goods_name+'');
				$('.goods_desc')[0].id = "desc_" + data.id;
				
				// 网络和出厂日期
				var net_date = '<p>';
				var net_date_arr = data.goods_date.split('，');
				$.each(net_date_arr, function(idx, val){
					net_date += val +' ';
				})
				net_date += '</p>';
				$('.goods_desc').after(net_date);

				// 编号
				$('.identifier').html(data.goods_number);
				// 赠送配件说明
				$('.goods_parts_cont').html(data.goods_parts);
				$('.goods_parts_img').html('<img src="__UPLOADS__/'+data.goods_parts_img+'">')
				// 配件大图
				$('.goods_parts_big_img div').html('<img src="__UPLOADS__/'+data.goods_parts_big_img+'">');
				// 规格图片
				$('.aui-card-list').append('<img src="__UPLOADS__/'+data.goods_spec_img+'">')
				// 质检图
				var quality = '<div><p class="zjtp_title"></p>';
				$.each(data.goods_quality_img, function(idx, val){
					if(val != null){
						quality += '<img src="__UPLOAD__/'+val+'">';
					}
				})
				quality += '</div>';
				$('.tabCon').before(quality);
				
				// IEMI号
				if(data.goods_imei != null){
					var imei = '<p class="imei">IMEI号：<input readonly id="input" value="'+data.goods_imei+'"><span onclick="copyUrl()" class="copy_imei">复制</span></p>';
					$('.zjtp_title').after(imei);
				}

				var img_num;
                // 图片放大
                // 给tpfd添加点击事件，事件委托img，获取img的src路径
                $('.tabBox').click(function(e){
                    var src = $(this).children('img')[0].src;
                    activeIndex = $(e.target).index();
                    img_num = $(this).children('img').length;
                    loadImage(src);
                })
                
                var activeIndex;//在tabBox的点击事件中获取当前图片的索引值
                $('.show-image').on('tap',function(){
                        $('.show-image').hide();
                    })
                    .on('swipeLeft',function(){
                        activeIndex++;
                        if(activeIndex > img_num - 1){
                            activeIndex = img_num - 1;
                        }else{
                            // 下一张图片的src
							var src = $('.tabBox').children('img')[activeIndex].src;
                            loadImage(src);
                        }
                    })
                    .on('swipeRight',function(){
                        activeIndex--;
                        if(activeIndex < 0){
                            activeIndex = 0
                        }else{
                            // 上一张图片的src
                            var src = $('.tabBox').children('img')[activeIndex].src;
                            loadImage(src);
                        }
                    })
				//show-image添加图片
                //获取可视窗口比例
                var bili = $(window).height() / $(window).width();
                function loadImage(src) {
                    $('.show-image').empty().show();//清空之前的图片
                    var oImg = new Image(),
                        oImage_src = src;
                    oImg.src = oImage_src;
                    oImg.onload = function () {
                        //等图片下载完再显示
                        //获取图片宽高比例
                        var img_h = this.height,
                            img_w = this.width;
                        if(img_h / img_w > bili){
                            $(oImg).appendTo($('.show-image')).css('height','100%').animate({opacity:1},500);
                        }else{
                            $(oImg).appendTo($('.show-image')).css('width','100%').animate({opacity:1},500);
                        }
                    }
                }

				// 价格
				$('.price').html('￥'+data.goods_bottom_money+' '+'<span class="goods_new_money">￥'+data.goods_new_money+'</span>');
				// 全新家

				xid = data.id;
				if(data.start_time != undefined){
					$('.time_box').css('display','block');
					// 活动开始时间
					var start_time = data.start_time*1000;
					// 活动结束时间
					var over_time = data.over_time*1000;

					// 倒计时函数
					function count_down(obj){
						// 获取当前时间
						var curr_time = new Date().getTime();
						// 时间差
						var to_start = obj - curr_time;
						// 剩余多少天，小时，分钟，秒
						var Day = parseInt(to_start/1000/3600/24) < 10 ? '0'+parseInt(to_start/1000/3600/24) : parseInt(to_start/1000/3600/24);
						var Hour = parseInt(to_start/1000/3600%24) < 10 ? '0'+parseInt(to_start/1000/3600%24) : parseInt(to_start/1000/3600%24);
						var Minutes = parseInt(to_start/1000/60%60) < 10 ? '0'+parseInt(to_start/1000/60%60) : parseInt(to_start/1000/60%60);
						var Second = parseInt(to_start/1000%60) < 10 ? '0'+parseInt(to_start/1000%60):  parseInt(to_start/1000%60);
						// 渲染到页面上
						$('.hour')[0].innerHTML = Hour;
						$('.minutes')[0].innerHTML = Minutes;
						$('.second')[0].innerHTML = Second;
						// 如果天数不为0，显示标签
						if(Day != 0){
							$($('.day')[0]).css('display','inline-block');
							$('.day')[0].innerHTML = Day + '天';
						}
					}
					// 显示距离活动开始的时间
					if(start_time - new Date().getTime() > 0){
						$('.time_text')[0].innerHTML = '距开始';
						setInterval(function(){
							count_down(start_time);
						},1000)
					}else{
						// 显示 距离活动结束的时间
						$('.time_text')[0].innerHTML = '距结束';
						setInterval(function(){
							count_down(over_time);
						},1000)
					}
				}
			},
			error: function(){
				console.log('错误')
			}
		})
	})()
	// 复制IMEI号
	function copyUrl() {
        var Url=document.getElementById('input');
        Url.select(); // 选择对象
        document.execCommand("Copy"); // 执行浏览器复制命令
        alert("复制成功！");
    }
</script>
<script>
    $(function () {
        $(".clickwn").click(function () {
            $(".flick-menu-mask").show();
            $(".spec-menu").show();
        })

        $(".tclck").click(function () {
            $(".flick-menu-mask").hide();
            $(".spec-menu").hide();
        })

		/* $("#cool").focus(function(){
		 var oi = $('#cool').val();

		 $('.amount').html(oi)
		 });*/

        $('#cool').bind('input propertychange', function () {
			/* alert(this.value);*/
            $('.amount').html(this.value)

        }).bind('input input', function () {

        });

        $('#color a').click(function () {
            var cook = $(this).index();
            $('#color a').eq(cook).addClass('selected').siblings().removeClass('selected');
        })

        $('#color1 a').click(function () {
            var cook = $(this).index();
            $('#color1 a').eq(cook).addClass('selected').siblings().removeClass('selected');
        })

        //加减面板
        $(function(){
            //加号
            $(".jia").click(function(){

                var $parent=$(this).parent(".num");
                var $num=window.Number($(".inputBorder",$parent).val());
                $(".inputBorder",$parent).val($num+1);

                $('.amount').html($num+1)

            });

            //减号
            $(".jian").click(function(){
                var $parent=$(this).parent(".num");
                var $num=window.Number($(".inputBorder",$parent).val());
                if($num>2){
                    $(".inputBorder",$parent).val($num-1);
                    $('.amount').html($num-1)

                }else{
                    $(".inputBorder",$parent).val(1);
                    $('.amount').html($num)
                }
            });

        })
    })
</script>
<script type="text/javascript">

    apiready = function () {
        api.parseTapmode();
    }
    var collapse = new auiCollapse({
        autoHide:false //是否自动隐藏已经展开的容器
    });

</script>

<script type="text/javascript">
	 var mySwiper = new Swiper ('.swiper-container', {
        direction: 'horizontal',
        loop: true,
        autoplay: true,
        delay: 3000,
        // 如果需要分页器
        pagination: {
            el: '.swiper-pagination',
        },
        // 如果需要滚动条
        scrollbar: {
            el: '.swiper-scrollbar',
        },
    });
    var slide2 = new auiSlide({
        container:document.getElementById("aui-slide2"),
        // "width":300,
        "height":290,
        "speed":300
    })

</script>
<!--获取陪同商品订单一起过来的用户id-->
<script>
	// 立即购买
	$("#buy_now").click(function () {
	    /*商品名*/
	    var goods_name = $('.goods_desc').html();
	    /*价格*/
	  	var price =  $('.price').html();

        $.ajax({
            type:'POST',
            url:'{:url("index/Order/common_id")}',
            dataType:'JSON',
			data:{
                "goods_name":goods_name,
                "price":price,
				'id': xid
			},
            success:function(data){
                console.log(data);
				location.href='order_index'
            },
            error: function(data){
                console.log('未登录');
                window.location.href ="login";
            }

        })
    });
	// 加入购物车
	$("#add_to_cart").click(function(){
		var myid = $('.goods_desc')[0].id.split('_')[1];
        $.ajax({
            type:'POST',
            url:'{:url("index/Shopping/ajax_id")}',
            dataType:'JSON',
			data:{
                'id':myid
			},
            success:function(data){
                location.href='shopping_index';
            },
            error: function(){
                console.log('未登录');
                location.href='login';
            }

        })
    });
	//收藏
	$('.collection_add').click(function () {
        $.ajax({
            type:'POST',
            url:'{:url("index/Collection/add")}',
            dataType:'JSON',
            data:{
                'id': xid
            },
            success:function(data){
//                console.log(data);
				if(data.info == '收藏成功'){
					$('.collection_add').children().addClass('aui-text-warning');
				}else if(data.info == '取消收藏成功'){
					$('.collection_add').children().removeClass('aui-text-warning');
				}
            },
            error: function(){
                console.log('未登录');
                window.location.href ="login";
            }

        })
    });
</script>

<!--收藏按钮样式修改-->
<script>
	(function(){
		$.ajax({
			url: '{:url("index/Collection/show_collection")}',
			type: 'POST',
			dataType: 'JSON',
			'data':{
				'id':xid
			},
			async: false,
			success: function(data){
				// console.log(data);
				if(data.data.status != null && data.data.status == 1){
					$('.collection_add').children().addClass('aui-text-warning');
				}
			},
			error: function(){
				// console.log('未收藏')
			}
		})
	})()

	// 购物车跳转
	$('.aui-icon-cart').click(function(){
		location.href='shopping_index';
	})
</script>
<!-- iphoneX适配 -->
<script>
	if($(window).width() === 375 && $(window).height() === 724 && window.devicePixelRatio === 3){
		$(".phonex-pb").css("padding-bottom","34px");
	}
</script>
</body>
</html>
