<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- 屏幕适配 -->
    <script src="__STATIC__/index/js/adaptation.js"></script>
    <link rel="stylesheet" href="__STATIC__/index/css/common.css">
    <title>我的消费</title>
    <style>
        html, body, .wrapper{background-color: #f2f2f2;}
        .header{position: relative;width: 100%;height: .88rem;background-color: #fff; display: flex; align-items: center; justify-content: space-around;}
        .header .head-txt{color: #333; font-size: .36rem;position: relative;}
        .header a:nth-of-type(2){text-align: right;}
        .header a:last-of-type{text-align: left;}
        .header a.head-txt-on{color: #504cfb;}
        .header a.head-txt-on::after{content: ''; position: absolute; right: 0;bottom: 0; border: 1px solid #504cfb; width: 100%;}
        .header .icon-back{position: absolute;left: .2rem;top: 50%;width: .25rem;height: .43rem;margin-top: -.22rem;background-position: -.5rem -.5rem;}
        .search-box{background-color: #fff;position: relative;}
        .search-box input{width: 75%;height: .7rem;background-color: rgba(0, 0, 0, .08);border-radius: .4rem;padding-left: .6rem;box-sizing: border-box;outline: none;margin: .2rem .3rem;}
        .search-box .icon-search{position: absolute;left: .45rem;top: 50%;width: .32rem;height: .33rem;margin-top: -.17rem;background-position: 0 0;}
        .search-btn{background-color: transparent; color: #999; font-size: .3rem; border: 0; outline: none;}
        .cost-li{background-color: #fff; border-bottom: 1px solid #eee; padding: .2rem .3rem;display: flex; align-items: center; justify-content: space-between;}
        .cost-li .cost-method{width: .96rem; height: .96rem;}
        .cost-li .cost-method img{width: 100%; height: 100%;}
        .cost-li .cost-info{flex-basis: 60%; line-height: normal;}
        .cost-li .cost-info p{font-size: .3rem; color: #333;}
        .cost-li .cost-info span{font-size: .24rem; color: #999;}
        .cost-li .cost-money{font-size: .34rem;}
        .month-tit{padding: .15rem 0 .15rem .3rem;}
        .bill-container{display: flex; align-items: center; justify-content: space-between; padding: .3rem .3rem;background-color: #fff; border-bottom: 1px solid #eee;}
    </style>
</head>
<body>
    <div class="wrapper">
        <header class="header">
            <a href="sell_my_index" class="spr icon-back"></a>
            <a href="sell_service_record" class="head-txt head-txt-on">账单</a>
            <!-- <a href="sell_parts_record" class="head-txt">商品账单</a> -->
        </header>
        <!-- <div class="search-box">
            <i class="spr icon-search"></i>
            <input type="text" placeholder="输入账单相关信息">
            <button class="search-btn">搜索</button>
        </div> -->
        <div class="cost-detail">
            <!-- <div class="cost-item">
                <h3 class="month-tit">10月</h3>
                <div class="bill-container">
                    <div class="income-container">收入：￥<span>10000</span></div>
                    <div class="expenditure">支出：￥<span>5000</span></div>
                </div>
                <ul class="cost-ul">
                    <li class="cost-li">
                        <div class="cost-method">
                            <img src="__STATIC__/index/image/wechat.png">
                        </div>
                        <div class="cost-info">
                            <p class="txt-hid-one">米其林轮胎车模清洁套装</p>
                            <span>12月04日 9:45</span>
                        </div>
                        <div class="cost-money">
                            -199.00
                        </div>
                    </li>
                </ul>
            </div> -->
        </div>
    </div>

    <script src="__STATIC__/index/js/plugin/jquery.js"></script>
    <script src="__STATIC__/index/js/plugin/layer.js"></script>
    <script>
        $.ajax({
            url: 'sell_service_record',
            type: 'POST',
            dataType: 'JSON',
            success: function(res){
                console.log(res);
                if(res.status == 1){
                    var data = res.data.wallet_record;
                    if(data.january.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.january, 1));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.sebruary.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.sebruary, 2));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.march.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.march, 3));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.april.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.april, 4));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.may.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.may, 5));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.june.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.june, 6));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.july.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.july, 7));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.august.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.august, 8));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.september.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.september, 9));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.october.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.october, 10));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.november.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.november, 11));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                    if(data.december.name.length > 0){
                        $('.cost-detail').prepend(mySplicing(data.december, 12));
                        $('.cost-li').click(function(){
                            checkDetail(this);
                        })
                    }
                }
            },
            error: function(){
                console.log('error');
            }
        })
        function mySplicing(data, month){
            console.log(data)
            var str = '';
            str += '<div class="cost-item">\
                        <h3 class="month-tit">'+month+'月</h3>\
                        <div class="bill-container">\
                            <div class="income-container">收入：￥<span>'+data.income+'</span></div>\
                            <div class="expenditure">支出：￥<span>'+data.expenditure+'</span></div>\
                        </div>\
                        <ul class="cost-ul">';
            data.name.forEach(function(val, idx){
                str += '<li class="cost-li" data-id="'+val.wallet_id+'">\
                            <div class="cost-method">\
                                <img src="__STATIC__/'+val.wallet_img+'">\
                            </div>\
                            <div class="cost-info">\
                                <p class="txt-hid-one">'+val.title+'</p>\
                                <span>'+val.operation_time+'</span>\
                            </div>\
                            <div class="cost-money">'+(val.wallet_operation > 0 ? '+'+val.wallet_operation : val.wallet_operation)+'</div>\
                        </li>'
            })
            str += '</ul>\
                </div>';
            return str;
        }
        function checkDetail(_this){
            var wallet_id = $(_this).attr('data-id');
            $.ajax({
                url: 'consume_save',
                type: 'POST',
                dataType: 'JSON',
                data: {
                    'wallet_id': wallet_id
                },
                success: function(res){
                    console.log(res);
                    if(res.status == 1){
                        location.href = 'sell_order_bill';
                    }
                },
                error: function(){
                    console.log('error');
                }
            })
        }
    </script>
</body>
</html>