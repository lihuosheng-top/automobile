{extend name="layout"} {block name="css"}
<style type="text/css">
	body {
		background: #fff;
	}
	.static{
		text-align: center;
	}
	.all p{
		text-align: center;
	}
	.all div{
		text-align: center;
	}
</style>

{/block}

<body>

	{block name="content"}
	<div class="all">
		<h2 class="static">待支付</h2>
		<p>商家名称：<span id="shop_name"></span></p>
		<p>支付金额：<span class="repay_money">￥250000</span></p>
		<div class="doms">
			<!--二维码-->
			<img alt="模式二扫码支付" src="" style="width:150px;height:150px;margin: 10px auto;" id="img_url" />
		</div>
		<div id="">
			<span class="weixin_ico"><img src="__STATIC__/admin/common/img/weixin.png"/></span>
			<span class="zhifubao_ico"><img src="__STATIC__/admin/common/img/weixin.png"/></span>
		</div>
		<div class="text">
			扫一扫完成支付
		</div>

	</div>

	{/block}

	<!--_footer 作为公共模版分离出去-->
	{include file="template/_footer" /}
	<!--/_footer 作为公共模版分离出去-->

	<!--请在下方写此页面业务相关的脚本-->
	{block name="bottom"}
	<script type="text/javascript">
		var loc = location.href;
		var n1 = loc.length; //地址的总长度
		var n2 = loc.indexOf("="); //取得=号的位置
		var id = decodeURI(loc.substr(n2 + 1, n1 - n2)); //从=号后面的内容
		var text = id.replace(/(.*)&.*/, '$1');
		var WIDsubject = text.replace(/(.*)&.*/, '$1');

		function GetQueryString(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
			var r = window.location.search.substr(1).match(reg); //获取url中"?"符后的字符串并正则匹配
			var context = "";
			if(r != null)
				context = r[2];
			reg = null;
			r = null;
			return context == null || context == "" || context == "undefined" ? "" : context;
		}
		var WIDbody = GetQueryString("WIDbody");
		var WIDtotal_amount = GetQueryString("WIDtotal_amount");

		$.ajax({
			type: "POST",
			url: "{:url('admin/Goods/WeiAlpay')}",
			data: {
				"WIDbody": WIDbody,
				"WIDsubject": WIDsubject,
				"WIDtotal_amount": WIDtotal_amount,
			},
			success: function(data) {
				//								console.log(data);
				var data = eval("(" + data + ")");
				console.log(data);
				var datas = "goods_qrcode?url2=" + data.data;
				$("#img_url").attr("src", datas);
			},

			error: function(data) {
				console.log("错误")
			}
		});
	</script>
	{/block}

</body>

</html>